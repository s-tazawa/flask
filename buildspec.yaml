# buildspec.yml
version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 12
    commands:
      # AWSCLIのインストール
      - curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
      - unzip awscliv2.zip
      - ls -l /root/.pyenv/shims/aws
      - ./aws/install --bin-dir /root/.pyenv/shims --install-dir /usr/local/aws-cli --update
      # npmのインストール
      - cd frontend
      - npm install
      - npm install -g forever
  pre_build:
    commands:
      # - sudo apt-get update && sudo apt-get install apt-transport-https
      # - curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
      # - echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/npm.list
      # - sudo apt-get update && sudo apt-get install npm
      - npm --version
      # - npm test
  build:
    commands:
      - npm run build
  post_build:
    commands:
      - aws s3 sync release s3://flask-frontend --delete --acl public-read 

      